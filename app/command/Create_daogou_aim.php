<?php
declare (strict_types = 1);

namespace app\command;

use think\console\Command;
use think\console\Input;
use think\console\input\Argument;
use think\console\input\Option;
use think\console\Output;
use think\facade\Db;
use app\admin\model\cip\DeptModel;
use app\admin\model\cip\SalesDayObjectTargetModel;
use app\api\service\dingding\SendpicService;

class Create_daogou_aim extends Command
{

    const DEAL_DATA = [

        '威信一店#5#152000#179000#28000',
        '昭通一店#5#169000#199000#30000',
        '楚雄一店#6#195000#229000#29000',
        '仁寿一店#4#127000#149000#28000',
        '南部一店#5#152000#179000#28000',
        '双流一店#5#152000#179000#28000',
        '合江一店#4#118000#139000#28000',
        '合江二店#5#118000#139000#28000',
        '大英一店#5#169000#199000#30000',
        '大英二店#4#118000#139000#28000',
        '安岳一店#7#399000#469000#50000',
        '宜宾一店#6#339000#399000#50000',
        '射洪一店#4#135000#159000#30000',
        '射洪二店#5#186000#219000#30000',
        '岳池一店#4#118000#139000#28000',
        '岳池二店#5#118000#139000#28000',
        '德阳一店#4#135000#159000#30000',
        '春熙路一店#9#671000#789000#65000',
        '武胜一店#4#118000#139000#28000',
        '武胜二店#4#135000#159000#30000',
        '珙县一店#5#152000#179000#28000',
        '米易一店#5#127000#149000#28000',
        '自贡一店#7#356000#419000#45000',
        '苍溪一店#5#162000#190000#29000',
        '苍溪二店#4#135000#159000#30000',
        '蓬溪一店#4#118000#139000#28000',
        '西昌一店#6#356000#419000#50000',
        '遂宁一店#7#399000#469000#50000',
        '长宁一店#5#178000#209000#31000',
        '阆中一店#6#178000#209000#28000',
        '亳州一店#3#93000#109000#28000',
        '巢湖一店#5#212000#249000#37000',
        '巢湖二店#5#212000#249000#37000',
        '滁州一店#5#161000#189000#28000',
        '舒城一店#5#144000#169000#28000',
        '萧县一店#5#152000#179000#28000',
        '青阳一店#5#203000#239000#36000',
        '东莞三店#5#135000#159000#28000',
        '中山二店#5#152000#179000#28000',
        '丰顺一店#4#93000#109000#28000',
        '乐昌一店#4#118000#139000#28000',
        '人和一店#5#169000#199000#30000',
        '兴宁一店#4#118000#139000#28000',
        '博罗一店#4#127000#149000#28000',
        '塘厦一店#5#237000#279000#42000',
        '塘厦二店#5#237000#279000#42000',
        '大朗一店#5#144000#169000#28000',
        '太和一店#5#220000#259000#39000',
        '太和二店#5#178000#209000#31000',
        '官窑一店#5#178000#209000#31000',
        '寮步一店#5#152000#179000#28000',
        '小金口一店#5#135000#159000#28000',
        '开平一店#4#118000#139000#28000',
        '德庆一店#5#135000#159000#28000',
        '惠东一店#6#254000#299000#37000',
        '惠东二店#4#152000#179000#33000',
        '揭西一店#4#135000#159000#30000',
        '新塘一店#4#118000#139000#28000',
        '普宁一店#5#161000#189000#28000',
        '水口一店#5#152000#179000#28000',
        '河源一店#5#135000#159000#28000',
        '河源三店#5#144000#169000#28000',
        '河源二店#5#152000#179000#28000',
        '湛江一店#5#144000#169000#30000',
        '狮岭一店#4#115000#135000#28000',
        '珠海一店#5#186000#219000#35000',
        '珠海三店#5#203000#239000#35000',
        '珠海二店#5#212000#249000#35000',
        '石碣一店#5#203000#239000#36000',
        '石龙一店#4#118000#139000#28000',
        '紫金一店#4#118000#139000#28000',
        '罗定一店#5#127000#149000#28000',
        '翁源一店#3#93000#109000#28000',
        '英德一店#5#152000#179000#33000',
        '蕉岭一店#4#93000#109000#28000',
        '西樵一店#5#186000#219000#33000',
        '连州一店#5#169000#199000#33000',
        '长安一店#5#237000#279000#40000',
        '阳春一店#6#183000#215000#30000',
        '阳春二店#6#217000#255000#32000',
        '顺德一店#4#123000#145000#28000',
        '顺德二店#5#195000#229000#34000',
        '高要二店#5#152000#179000#30000',
        '龙川一店#5#135000#159000#28000',
        '大石二店#0#373000#439000#0',
        '广州一店#5#373000#439000#66000',
        '厚街一店#5#186000#219000#33000',
        '厚街二店#5#152000#179000#30000',
        '坑梓一店#5#212000#249000#37000',
        '坪山一店#5#212000#249000#37000',
        '布吉一店#5#186000#219000#33000',
        '松岗一店#6#212000#249000#31000',
        '福永一店#4#127000#149000#28000',
        '虎门一店#5#161000#189000#28000',
        '西乡一店#5#203000#239000#36000',
        '龙华一店#5#161000#189000#28000',
        '龙岗一店#4#161000#189000#35000',
        '横岗一店#6#196000#229000#30000',
        '北流一店#6#229000#269000#34000',
        '北海一店#6#263000#309000#39000',
        '南丹一店#4#127000#149000#28000',
        '南宁一店#9#739000#869000#66000',
        '南宁二店#9#739000#869000#66000',
        '大沙田一店#4#178000#209000#39000',
        '宜州一店#4#152000#179000#33000',
        '容县一店#5#186000#219000#33000',
        '宾阳一店#3#93000#109000#28000',
        '巴马一店#5#152000#179000#28000',
        '昭平一店#3#118000#139000#35000',
        '柳城一店#4#152000#179000#33000',
        '桂平一店#5#220000#259000#39000',
        '武宣一店#4#169000#199000#37000',
        '浦北一店#5#208000#245000#37000',
        '灵山一店#4#161000#189000#35000',
        '百色一店#6#229000#269000#34000',
        '百色二店#5#161000#189000#28000',
        '良庆一店#3#118000#139000#35000',
        '贵港一店#4#110000#129000#28000',
        '都安一店#4#127000#149000#28000',
        '钦州一店#4#127000#149000#28000',
        '防城一店#6#263000#309000#39000',
        '防城二店#6#263000#309000#39000',
        '陆川一店#4#149000#175000#33000',
        '万载一店#4#152000#179000#33000',
        '上高一店#5#195000#229000#34000',
        '上高二店#3#101000#119000#30000',
        '临川一店#6#237000#279000#35000',
        '乐平一店#6#280000#329000#41000',
        '乐平二店#6#263000#309000#39000',
        '九江一店#5#152000#179000#28000',
        '九江三店#5#229000#269000#40000',
        '九江二店#5#152000#179000#28000',
        '九江五店#7#314000#369000#39000',
        '于都一店#5#203000#239000#36000',
        '于都二店#5#203000#239000#36000',
        '余干一店#5#195000#229000#34000',
        '余干二店#6#220000#259000#32000',
        '信丰一店#5#229000#269000#40000',
        '信丰二店#5#229000#269000#40000',
        '修水一店#5#203000#239000#36000',
        '兴国一店#5#203000#239000#36000',
        '南丰一店#5#186000#219000#33000',
        '南城一店#4#161000#189000#35000',
        '南昌一店#5#186000#219000#33000',
        '南昌三店#5#195000#229000#34000',
        '南昌五店#6#246000#289000#36000',
        '南昌六店#6#195000#229000#29000',
        '吉安一店#5#254000#299000#45000',
        '吉水一店#5#152000#179000#28000',
        '大余一店#3#110000#129000#32000',
        '大余二店#4#169000#199000#37000',
        '奉新一店#4#127000#149000#28000',
        '宁都一店#5#229000#269000#40000',
        '宁都二店#5#203000#239000#36000',
        '安远一店#5#246000#289000#43000',
        '宜春一店#7#339000#399000#43000',
        '宜春二店#6#314000#369000#46000',
        '崇义二店#5#169000#199000#30000',
        '崇仁一店#4#135000#159000#30000',
        '崇仁二店#4#135000#159000#30000',
        '弋阳一店#6#288000#339000#42000',
        '德兴一店#5#212000#249000#37000',
        '德安一店#4#161000#189000#35000',
        '德安二店#4#101000#119000#28000',
        '抚州一店#6#220000#259000#32000',
        '新余一店#7#433000#509000#54000',
        '新干一店#4#110000#129000#28000',
        '新建一店#5#203000#239000#36000',
        '新建二店#5#169000#199000#30000',
        '景德镇三店#5#169000#199000#30000',
        '景德镇二店#5#186000#219000#33000',
        '横峰一店#5#169000#199000#30000',
        '瑞昌一店#4#169000#199000#37000',
        '石城一店#5#169000#199000#30000',
        '莲塘一店#6#339000#399000#50000',
        '莲塘二店#5#246000#289000#43000',
        '萍乡一店#6#271000#319000#40000',
        '萍乡二店#5#169000#199000#30000',
        '贵溪一店#5#195000#229000#36000',
        '贵溪三店#5#203000#239000#36000',
        '贵溪二店#5#220000#259000#36000',
        '资溪一店#5#127000#149000#28000',
        '赣州一店#7#458000#539000#50000',
        '赣州三店#6#288000#339000#45000',
        '赣州二店#5#263000#309000#45000',
        '进贤一店#5#195000#229000#34000',
        '进贤三店#5#237000#279000#42000',
        '进贤二店#5#246000#289000#43000',
        '进贤五店#4#110000#129000#28000',
        '鄱阳一店#4#135000#159000#30000',
        '鄱阳二店#6#331000#389000#49000',
        '铅山一店#5#246000#289000#43000',
        '铅山二店#5#212000#249000#37000',
        '靖安一店#5#178000#209000#31000',
        '鹰潭一店#7#373000#439000#47000',
        '龙南一店#5#186000#219000#33000',
        '万年一店#5#169000#199000#30000',
        '万年二店#5#169000#199000#30000',
        '上饶一店#5#203000#239000#36000',
        '上饶三店#5#271000#319000#48000',
        '上饶二店#5#178000#209000#31000',
        '上饶五店#5#228000#268000#40000',
        '上饶六店#7#424000#499000#53000',
        '广丰三店#5#161000#189000#28000',
        '广丰二店#5#195000#229000#34000',
        '广丰五店#6#242000#285000#35000',
        '玉山一店#5#186000#219000#33000',
        '玉山二店#5#186000#219000#33000',
        '焦作一店#5#144000#169000#28000',
        '郑州一店#7#322000#379000#40000',
        '郑州二店#5#186000#219000#33000',
        '江山一店#4#144000#169000#32000',
        '江山三店#4#170000#199900#37000',
        '海口一店#6#229000#269000#34000',
        '海口二店#7#288000#339000#36000',
        '琼海一店#5#152000#179000#28000',
        '仙桃一店#6#212000#249000#31000',
        '大悟一店#5#161000#189000#28000',
        '孝感一店#5#178000#209000#31000',
        '孝感二店#5#161000#189000#28000',
        '武汉二店#5#195000#229000#34000',
        '汉川一店#5#237000#279000#40000',
        '汉川二店#4#101000#119000#28000',
        '洪湖二店#4#127000#149000#28000',
        '浠水二店#7#162000#190000#30000',
        '罗田一店#5#170000#199900#30000',
        '罗田二店#5#118000#139000#28000',
        '英山一店#5#195000#229000#34000',
        '随州一店#6#229000#269000#36000',
        '随州二店#6#246000#289000#36000',
        '麻城一店#6#195000#229000#29000',
        '麻城二店#5#161000#189000#29000',
        '咸宁一店#5#212000#249000#37000',
        '咸宁二店#5#203000#239000#37000',
        '蕲春一店#5#144000#169000#28000',
        '通城一店#5#161000#189000#28000',
        '通山二店#6#203000#239000#30000',
        '鄂州一店#5#169000#199000#30000',
        '阳新一店#7#297000#349000#35000',
        '阳新二店#6#212000#249000#35000',
        '黄梅一店#4#123000#145000#28000',
        '黄石一店#7#297000#349000#37000',
        '黄石二店#6#212000#249000#33000',
        '保康一店#4#127000#149000#28000',
        '十堰一店#5#161000#189000#30000',
        '十堰三店#7#322000#379000#40000',
        '十堰二店#6#322000#379000#40000',
        '宜城一店#4#118000#139000#28000',
        '宜昌二店#5#161000#189000#30000',
        '宣恩一店#5#127000#149000#28000',
        '恩施一店#5#220000#259000#35000',
        '枝江一店#4#135000#159000#30000',
        '枣阳一店#4#127000#149000#28000',
        '沙洋一店#5#169000#199000#30000',
        '竹山一店#5#161000#189000#28000',
        '荆州一店#5#229000#269000#40000',
        '荆州二店#5#229000#269000#40000',
        '襄阳一店#6#203000#239000#30000',
        '远安一店#5#127000#149000#28000',
        '保靖一店#5#144000#169000#30000',
        '凤凰二店#5#161000#189000#28000',
        '吉首一店#5#135000#159000#28000',
        '安化一店#5#203000#239000#36000',
        '安化二店#5#203000#239000#36000',
        '常德三店#7#314000#369000#39000',
        '常德二店#5#186000#219000#33000',
        '怀化一店#4#135000#159000#30000',
        '怀化二店#4#135000#159000#30000',
        '慈利一店#4#110000#129000#28000',
        '桑植一店#3#93000#109000#28000',
        '桑植二店#4#135000#159000#30000',
        '永顺二店#6#186000#219000#30000',
        '汨罗一店#6#220000#259000#32000',
        '泸溪一店#5#152000#179000#30000',
        '洪江一店#4#127000#149000#28000',
        '浏阳一店#5#212000#249000#37000',
        '涟源一店#5#195000#229000#34000',
        '湘阴一店#5#186000#219000#33000',
        '湘阴二店#5#186000#219000#33000',
        '溆浦一店#5#212000#249000#37000',
        '石门一店#5#203000#239000#36000',
        '花垣一店#5#186000#219000#33000',
        '芷江一店#5#169000#199000#30000',
        '辰溪一店#5#135000#159000#28000',
        '醴陵一店#5#203000#239000#36000',
        '长沙二店#5#195000#229000#34000',
        '龙山一店#5#135000#159000#28000',
        '武冈一店#4#118000#139000#28000',
        '洞口一店#5#220000#259000#39000',
        '绥宁一店#4#135000#159000#30000',
        '蓝山一店#5#178000#209000#31000',
        '衡阳二店#5#135000#159000#28000',
        '通道一店#4#135000#159000#30000',
        '邵东一店#6#237000#279000#35000',
        '邵东三店#5#220000#259000#39000',
        '邵阳一店#5#203000#239000#36000',
        '郴州一店#5#203000#239000#36000',
        '郴州二店#5#203000#239000#36000',
        '兰州一店#5#280000#329000#49000',
        '平凉一店#6#203000#239000#30000',
        '仙游一店#6#212000#249000#31000',
        '晋江一店#5#161000#189000#28000',
        '桐梓一店#4#127000#149000#28000',
        '桐梓二店#5#127000#149000#22000',
        '织金一店#8#424000#499000#47000',
        '道真一店#4#118000#139000#26000',
        '遵义一店#5#169000#199000#30000',
        '遵义三店#5#178000#209000#31000',
        '遵义二店#4#118000#139000#28000',
        '金沙一店#5#195000#229000#34000',
        '金沙二店#5#161000#189000#28000',
        '黔西一店#5#203000#239000#36000',
        '黔西三店#5#169000#199000#30000',
        '黔西二店#5#203000#239000#36000',
        '三穗一店#5#169000#199000#30000',
        '三都一店#5#195000#229000#34000',
        '从江一店#4#144000#169000#32000',
        '从江二店#4#118000#139000#28000',
        '兴义三店#7#458000#539000#58000',
        '兴义二店#6#220000#259000#32000',
        '凯里一店#5#203000#239000#36000',
        '剑河一店#5#186000#219000#33000',
        '天柱一店#5#152000#179000#28000',
        '德江三店#5#161000#189000#28000',
        '德江五店#5#161000#189000#28000',
        '德江五店#5#161000#189000#28000',
        '思南一店#5#186000#219000#33000',
        '松桃一店#6#220000#259000#32000',
        '松桃二店#5#161000#189000#28000',
        '湄潭一店#5#151000#178000#28000',
        '玉屏一店#5#169000#199000#30000',
        '石阡一店#6#203000#239000#30000',
        '福泉一店#5#161000#189000#28000',
        '荔波一店#5#203000#239000#36000',
        '都匀一店#6#259000#305000#38000',
        '镇远一店#5#161000#189000#28000',
        '镇远二店#4#118000#139000#28000',
        '黎平一店#5#169000#199000#30000',
        '六枝一店#6#229000#269000#34000',
        '六盘水一店#6#246000#289000#36000',
        '大方一店#4#144000#169000#32000',
        '威宁一店#5#127000#149000#28000',
        '毕节一店#4#135000#159000#30000',
        '安顺一店#6#322000#379000#47000',
        '安顺二店#7#322000#379000#40000',
        '惠水一店#5#220000#259000#39000',
        '普定一店#6#271000#319000#40000',
        '清镇一店#4#144000#169000#32000',
        '清镇二店#5#229000#269000#40000',
        '花溪三店#5#203000#239000#36000',
        '贵阳一店#5#212000#249000#37000',
        '长顺一店#5#169000#199000#30000',
        '云阳一店#5#212000#249000#37000',
        '北碚一店#5#220000#259000#38000',
        '奉节一店#6#220000#259000#32000',
        '奉节二店#5#178000#209000#31000',
        '荣昌一店#6#229000#269000#34000',
        '酉阳一店#5#161000#189000#28000',
        '长寿一店#5#127000#149000#28000',
        '城固一店#5#135000#159000#28000',
        '大荔一店#5#169000#199000#30000',
        '安康一店#7#330000#387900#41000',
        '汉中一店#5#220000#259000#39000',
        '汉中二店#7#322000#379000#40000',
        '西安二店#5#203000#239000#36000',
    
    ];

    protected function configure()
    {
        // 指令配置
        $this->setName('create_daogou_aim')
            ->setDescription('the create_daogou_aim command');
    }

    protected function execute(Input $input, Output $output)
    {
        ini_set('memory_limit','500M');
        $service = new SendpicService();
        $month_total_days = date('t');

        $start_date = date("Y-m-d", (strtotime(date('Y-m-01')) - 24*60*60) );

        $data = self::DEAL_DATA;
        foreach ($data as $v_data) {
            $explode = explode('#', $v_data);
            $dept_info = DeptModel::where([['name', '=', $explode[0]]])->field('id,name')->find();
            if (!$dept_info) {
                continue;
            }
            $daogous = $service->get_daogou_users($dept_info['id']);
            $daogous_num = count($daogous);
            // print_r($daogous);die;

            // $start_date = '2023-05-31';
            //店铺
            for ($i=1; $i<=$month_total_days; $i++) {
                $current_date = date("Ymd", (strtotime($start_date) + 24*60*60*$i) );
                $insert_data = [
                    'type' => '0',
                    'for_type' => '0',
                    'for_id' => $dept_info['id'],
                    'date' => $current_date,
                    'amount' => round($explode[3]/$month_total_days, 2),
                    'old_amount' => round($explode[2]/$month_total_days, 2),
                ];
                SalesDayObjectTargetModel::create($insert_data);
            }

            //员工
            if ($daogous) {
                foreach ($daogous as $v_daogou) {

                    for ($i=1; $i<=$month_total_days; $i++) {
                        $current_date = date("Ymd", (strtotime($start_date) + 24*60*60*$i) );
                        // echo $current_date;die;
                        $insert_data = [
                            'type' => '0',
                            'for_type' => '1',
                            'for_id' => $v_daogou['id'],
                            'date' => $current_date,
                            'amount' => round($explode[4]/$month_total_days, 2),
                            'old_amount' => round(($explode[2]/$month_total_days)/$daogous_num, 2),
                        ];
                        SalesDayObjectTargetModel::create($insert_data);
                    }

                }
            }
            
        }

        echo 'okk';die;
    }

}
